#!/bin/bash

ROOTDIR="$(dirname $(cd $(dirname $0) && pwd))"

APP="$1"
CMD="$2"

# Handle server commands

if [ $APP == "server" ]; then

    if [ ! $CMD ]; then
        $ROOTDIR/bin/app server serve

    elif [ $CMD == "init" ]; then
        $ROOTDIR/bin/server-init $ROOTDIR

    elif [ $CMD == "install" ]; then
        $ROOTDIR/bin/server-install $ROOTDIR ${@:2}

    elif [ $CMD == "build" ]; then
        $ROOTDIR/bin/server-static $ROOTDIR

    elif [ $CMD == "serve" ]; then
        $ROOTDIR/bin/server-serve $ROOTDIR

    fi

# Handle client commands

elif [ "$APP" == "client" ]; then

    if [ ! $CMD ]; then
        $ROOTDIR/bin/app client serve

    elif [ $CMD == "init" ]; then
        $ROOTDIR/bin/app client install
        $ROOTDIR/bin/app client serve

    elif [ $CMD == "install" ]; then
        $ROOTDIR/bin/client-install $ROOTDIR ${@:2}

    elif [ $CMD == "serve" ]; then
        cd $ROOTDIR/client
        yarn start

    fi

# Handle invalid command structure

else
    printf "\n[usage] bin/{dir}/script {app} {command} {args?}\n\n"

fi
